var Candidatometro=Candidatometro||{};Candidatometro.Totals=function(){"use strict";function a(c){b=c,b.each(function(){var a=d3.select(this);a.append("h6").attr("class","tc-tot")}),a.update()}var b;return a.update=function(){b.each(function(b){var c=d3.select(this),d=b.data.values(),e=15,f=[{name:"Positivo",cls:"bc-pos",count:d3.sum(d,function(a){return a.pos})},{name:"Neutro",cls:"bc-neu",count:d3.sum(d,function(a){return a.neu})},{name:"Negativo",cls:"bc-neg",count:d3.sum(d,function(a){return a.neg})}],g=d3.sum(f,function(a){return a.count}),h=_.template("<%= total %> POSTS",{total:g.toLocaleString()});f.forEach(function(a){a.perc=100*a.count/g}),c.select("h6.tc-tot").text(h);var i=c.selectAll("div").data(f).enter().append("div").attr("class","row");i.append("div").attr("class","col-sm-4 tright").append("p").text(function(a){return a.name});var j=i.append("div").attr("class","col-sm-7"),k=a.int(j.style("width")),l=j.append("svg").attr("width",k).attr("height",e),m=d3.scale.linear().domain([0,100]).range([0,k-20]);l.append("rect").attr("width",function(a){return m(a.perc)}).attr("height",e).attr("class",function(a){return a.cls}),l.append("text").attr("x",function(a){return m(a.perc)+2}).attr("y",e-2).text(function(a){return a.perc.toFixed(1)+"%"}).attr("fill","#555")})},a.int=function(a){return parseInt(a,10)},_.extend(a,Backbone.Events),a},Candidatometro.BubbleChart=function(){"use strict";function a(a){c=a,c.each(function(){})}var b,c,d=d3.map();return a.update=function(){c.each(function(b){var c=d3.select(this),e=d.get(b.name),f=c.selectAll("div").data(e).enter().append("div").attr("class","graph-cell");f.append("div").attr("class","visible-xs visible-sm topic-label").text(function(a){return a.name});var g=f.append("div").attr("class","svg-container"),h=a.int(g.style("height")),i=h,j=h/2-1,k=g.append("svg").attr("width",i).attr("height",h),l=d3.scale.sqrt().domain(d3.extent(e,function(a){return a.total})).range([2,j]);k.append("circle").attr("cx",i/2).attr("cy",h/2).attr("r",function(a){return l(a.total)}).attr("class","bubble").on("mouseover",function(a){console.log(a)})})},a.int=function(a){return parseInt(a,10)},a.mdataset=function(c){return b=c,a.listenTo(b,"multidataset:ready",a.parseData),a},a.parseData=function(){b.keys().forEach(function(a){var c=b.get(a).items(),e=[];c.forEach(function(a,b){var c={name:a,pos:0,neg:0,neu:0,total:0};b.forEach(function(a,b){c.pos+=b.pos,c.neg+=b.neg,c.neu+=b.neu}),c.total=c.pos+c.neg+c.neu,e.push(c)}),d.set(a,e)}),a.trigger("data:ready")},_.extend(a,Backbone.Events),a.on("data:ready",a.update),a},Candidatometro.BarChart=function(){"use strict";function a(e){b=e,b.each(function(){var b=d3.select(this),e=b.append("svg"),f=a.int(b.style("width"))-30;e.attr("width",f).attr("height",d),e.append("g").attr("class","bc-chart").attr("transform",a.svgt([c.left,c.top])),e.append("g").attr("class","bc-xaxis").attr("transform",a.svgt([c.left,d+c.top])),e.append("g").attr("class","bc-yaxis").attr("transform",a.svgt([0,c.top]))}),a.update()}var b,c={top:2,right:10,bottom:18,left:30},d=80,e=null,f=null;return a.update=function(){b.each(function(b){var d=_.pluck(b.data.entries(),"value"),e=d3.select(this),f=a.int(e.style("width"))-c.left-c.top,g=a.int(e.style("height"))-c.top-c.bottom,h=e.select("svg"),i=h.select("g.bc-chart"),j=h.select("g.bc-xaxis"),k=h.select("g.bc-yaxis");h.attr("width",f+c.left+c.right).attr("height",g+c.top+c.bottom),j.attr("transform",a.svgt([c.left,g+c.top])),k.attr("transform",a.svgt([c.left,c.top]));var l=a.int(f/a.timeDomain().length),m=d3.time.scale().domain(d3.extent(a.timeDomain())).rangeRound([l/2,f-l/2]),n=d3.extent(d,function(a){return d3.max([a.pos+a.neu/2,a.neg+a.neu/2])}),o=a.postDomain()?a.postDomain():n,p=d3.scale.linear().domain(o).range([2,g/2]),q=i.selectAll("g.bc-item").data(d).enter().append("g").attr("class","bc-item").attr("transform",function(b){return a.svgt([m(b.date)-l/2,g/2])}).on("mouseover",function(a){d3.select(this).append("text").attr("class","bc-info").attr("x",10).attr("y",0).text(a.date)});q.append("rect").attr("y",function(a){return-p(a.pos+a.neu/2)}).attr("width",l).attr("height",function(a){return p(a.pos+a.neu/2)}).attr("class","bc-pos"),q.append("rect").attr("y",0).attr("width",l).attr("height",function(a){return p(a.neg+a.neu/2)}).attr("class","bc-neg"),q.append("rect").attr("y",function(a){return-p(a.neu/2)}).attr("width",l).attr("height",function(a){return p(a.neu)}).attr("class","bc-neu"),q.append("rect").attr("y",-g/2).attr("height",g).attr("width",l).classed("bc-phantom",!0).on("mouseover",function(a){var b=d3.select("body").append("div").attr("class","bc-tooltip");b.append("p").attr("class","bc-tooltip-title").text(a.date.toDateString());var c=b.append("p").attr("class","bc-tooltip-info");c.append("span").text(a.pos).attr("class","bc-pos"),c.append("span").text(" + "),c.append("span").text(a.neu).attr("class","bc-neu"),c.append("span").text(" + "),c.append("span").text(a.neg).attr("class","bc-neg"),c.append("span").text(" = "),c.append("span").text(a.pos+a.neu+a.neg)}).on("mousemove",function(){var b=d3.select("body").select("div.bc-tooltip"),c=a.int(b.style("height"));b.style("left",d3.event.pageX+10+"px").style("top",d3.event.pageY-c/2+"px")}).on("mouseout",function(){d3.select("body").select("div.bc-tooltip").remove()});var r=d3.svg.axis().scale(m).orient("bottom").tickFormat(d3.time.format("%e %b %Y")),s=p.range(),t=d3.scale.linear().domain(o).range([s[1],s[0]]),u=d3.svg.axis().scale(t).ticks(4).outerTickSize(0).orient("left");j.call(r),k.call(u)})},a.timeDomain=function(b){return arguments.length?(e=b,a):e},a.postDomain=function(b){return arguments.length?(f=b,a):f},a.int=function(a){return parseInt(a,10)},a.svgt=function(a){return"translate("+a+")"},a.svgs=function(a){return"scale("+a+")"},_.extend(a,Backbone.Events),a},Candidatometro.MultiDataset=function(){"use strict";function a(){}var b,c=0,d=d3.map();return a.data=function(c){return b=c,b.forEach(function(b){var c=Candidatometro.Dataset().json(b.url);d.set(b.name,c),a.listenTo(c,"dataset:ready",a.waitData)}),a},a.waitData=function(){c+=1,c===b.length&&a.trigger("multidataset:ready")},a.get=function(a){return d.get(a)},a.keys=function(){return d.keys()},a.map=function(){return d},_.extend(a,Backbone.Events),a},Candidatometro.Dataset=function(){"use strict";function a(){}var b,c=d3.map();return a.json=function(d){return d3.json(d,function(d){function e(a){a.values=d3.map(),a.data.forEach(function(b){var c=b.t.split("-").map(function(a){return+a});a.values.set(b.t,{neg:b.n,neu:b.m,pos:b.p,date:new Date(c[0],c[1]-1,c[2])})}),a.children&&a.children.forEach(function(b){e(b),b.values.forEach(function(b,c){var d=a.values.get(b);a.values.set(b,{neg:d.neg+c.neg,neu:d.neu+c.neu,pos:d.pos+c.pos,date:d.date})})})}b=d,b.children.forEach(function(a){e(a),c.set(a.name,a.values)}),a.trigger("dataset:ready")}),a},a.data=function(){return b},a.items=function(){return c},_.extend(a,Backbone.Events),a};